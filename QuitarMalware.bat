@echo off
Title=QuitarMalware3 - blaslopez@gmail.com
color 9F
cls
if exist D:\CMD\icono.bat type D:\CMD\icono.bat
ping 127.0.0.1 -n 3 > NUL
SET RTA=0
SET SIGUE=1
:CARTEL
CLS
echo  (( %COMPUTERNAME% )) ejecutando 
echo  -------------------------------------*******************
echo  -------------------------------------+ QUITAR MALWARE  +
echo        + Limpieza y proteccion de memorias USB y Discos + 
echo        + blaslopez@gmail.com           v3.99 - 20150430 +
echo        **************************************************
goto CONTINUA%SIGUE%
:CONTINUA1
echo  ---------------------------------------------------------------
echo  %USERNAME% LEA POR FAVOR: 
echo     - Para DESINFECTAR::: EJECUTAR COMO ADMINISTRADOR !!!
echo       Cerra y comenza de nuevo con CLIC DERECHO.
echo  +                                                             +
echo     - Usar en compus sin virus para limpiar memorias y 
echo       pendrives. En caso que el sistema se halle infectado
echo       responde S en DESHABILITAR Sistema o busca al RTI.
echo  +                                                             +
echo     - Si al finalizar encuentra carpetas REVISAME en la 
echo       unidad desinfectada, ingrese parar recuperar sus
echo       carpetas y archivos que pueden estar alli.
echo  ---------------------------------------------------------------
rem NOTAS de la Version 3
rem Agregado 
rem          - busqueda y eliminacion de exe en Roamming
rem          - destino de instalacion desde pendrive configurable
rem Falta    
rem          - quitar del registro inicio de exe de Roamming
rem          - arreglar registro despues de la desinfeccion
pause
cls
rem Argumentos recibidos desde linea de comandos
rem NADA
if "%1"=="" goto UFaltaIngresar
rem INSTALAR desde el servidor
if "%1"=="SRV" goto SRVInstalar
rem Existe la UNIDAD
if not exist %1: goto UdadaError

:UdadaLimpiar
SET ULIMPIAR=%1
goto LimpiarInicio

:UdadaError
echo //
echo // ERROR
echo // -------------------------------------------------------------
echo // %USERNAME%
echo    No existe la unidad "%ULIMPIAR%" o la escribiste mal por favor
echo    responde a continuacion 
echo .-
pause
:UFaltaIngresar
SET SIGUE=2
GOTO CARTEL
:CONTINUA2
echo // 
echo // -------------------------------------------------------------
echo // MENU de limpieza:
echo // ----------------
echo // - E   : Limpiar solo la Unidad E.
echo // - USB : Limpiar TODOS los Discos Extraibles.
echo //         por ejemplo: pendrives, memorias, etc.
echo // - HD  : Limpiar TODOS los Discos Fijos.
echo // 
echo // MENU de Instalacion:
echo // -------------------
echo // - SRV : Instalar en D:\CMD desde el servidor.
echo // - LOC : Instalar en D:\CMD desde un pendrive.
echo // - COP : Copiar a un pendrive desde D:\CMD.
echo //
SET ULIMPIAR=USB
SET /P ULIMPIAR="--(( %USERNAME% Escriba su OPCION [%ULIMPIAR%]: "
echo .-

rem Verificando si iniciar la Instalacion
echo "A B C D E F G H I J K L M O P Q R S T U V W X Y Z" | find "%ULIMPIAR%" /i /c 
if %ERRORLEVEL% EQU 0 goto LimpiarInicio
echo "USB HD" | find "%ULIMPIAR%" /i /c 
if %ERRORLEVEL% EQU 0 goto LimpiarInicio
echo "SRV LOC COP" | find "%ULIMPIAR%" /i /c 
if %ERRORLEVEL% EQU 0 goto InstalarInicio
goto UdadaError

:InstalarInicio
cls
SET SIGUE=3
GOTO CARTEL
:CONTINUA3
echo // 
echo //  PREPARANDO LA INSTALACION
echo // -------------------------------------------------------------
echo //
SET RTA=0
SET /P RTA="--(( lugar? si no sabe solo pulse ENTER [%RTA%]: "
echo .-
if "%ULIMPIAR%" EQU "SRV" goto SRVInstalar
if "%ULIMPIAR%" EQU "srv" goto SRVInstalar
if "%ULIMPIAR%" EQU "LOC" goto LOCInstalar
if "%ULIMPIAR%" EQU "loc" goto LOCInstalar
if "%ULIMPIAR%" EQU "COP" goto COPInstalar
if "%ULIMPIAR%" EQU "cop" goto COPInstalar

rem Para Limpiar
:LimpiarInicio
cls
SET SIGUE=4
GOTO CARTEL
:CONTINUA4
echo // 
echo //  PREPARANDO LA DESINFECCION
echo // -------------------------------------------------------------
echo // %USERNAME%
echo    Quiza necesite DESHABILITAR el sistema por unos 
echo    instantes mientras se realiza la desinfeccion...
echo //
SET RTA=N
SET /P RTA="--(( Deshabilitar S o N? [%RTA%]: "
echo .-
if "%RTA%" EQU "N" goto :LimpiarEvaluar
if "%RTA%" EQU "n" goto :LimpiarEvaluar
echo --(( Cerrando el Explorer...
taskkill /f /im explorer.exe
reg add HKLM\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced\Folder\Hidden\SHOWALL /v CheckedValue /t REG_DWORD /d 1 /f
echo --(( Buscando y Eliminando procesos activos de Appdata\Roaming...
cd  "%userprofile%\Appdata\Roaming"
for /f %%VIRUS IN ('dir /b /ah *.exe') do (
	tasklist /FI "IMAGENAME EQ %%VIRUS" 2>NUL | Find /I /N "%%VIRUS" > NUL
	if %ERRORLEVEL% EQU 0 taskkill /f /im %%VIRUS
	attrib -r -s -h %%VIRUS
	del /f /q %%VIRUS
)
echo .-
echo --(( Buscando y Eliminando procesos activos conocidos como malware...
tasklist /FI "IMAGENAME EQ algsrvs.exe" 2>NUL | Find /I /N "algsrvs.exe" > NUL
if %ERRORLEVEL% EQU 0 taskkill /f /im algsrvs.exe
tasklist /FI "IMAGENAME EQ fun.xls.exe" 2>NUL | Find /I /N "fun.xls.exe" > NUL
if %ERRORLEVEL% EQU 0 taskkill /f /im fun.xls.exe
tasklist /FI "IMAGENAME EQ msfun80.exe" 2>NUL | Find /I /N "msfun80.exe" > NUL
if %ERRORLEVEL% EQU 0 taskkill /f /im msfun80.exe
tasklist /FI "IMAGENAME EQ msime82.exe" 2>NUL | Find /I /N " msime82.exe" > NUL
if %ERRORLEVEL% EQU 0 taskkill /f /im  msime82.exe
if exist "c:\windows\system32\nmdfgds0.dll" (
	attrib -r -s -h  "c:\windows\system32\nmdfgds0.dll"
	del /f /q  "c:\windows\system32\nmdfgds0.dll" 
)
if exist "c:\windows\system32\nmdfgds1.dll" (
	attrib -r -s -h  "c:\windows\system32\nmdfgds1.dll"
	del /f /q "c:\windows\system32\nmdfgds1.dll"
)
if exist "c:\windows\system32\nmdfgds2.dll" (
	attrib -r -s -h  "c:\windows\system32\nmdfgds2.dll"
	del /f /q "c:\windows\system32\nmdfgds2.dll"
)
if exist "c:\windows\system32\msime82.exe" (
	attrib -r -s -h  "c:\windows\system32\msime82.exe"
	del /f /q "c:\windows\system32\msime82.exe"
)
if exist "c:\windows\system32\msfun80.exe" (
	attrib -r -s -h  "c:\windows\system32\msfun80.exe"
	del /f /q "c:\windows\system32\msfun80.exe"
)
if exist "c:\windows\system32\algsrvs.exe" (
	attrib -r -s -h  "c:\windows\system32\algsrvs.exe"
	del /f /q "c:\windows\system32\algsrvs.exe"
)
if exist "C:\windows\system32\olhrwef.exe" (
attrib -r -s -h  "C:\windows\system32\olhrwef.exe"
del /f /q "C:\windows\system32\olhrwef.exe"
)
c:
echo --(( Eliminando RECYCLER...
cd\
if exist RECYCLER (
	cd RECYCLER
	attrib -r -s -h *.* /s /d
	rem del *.* /f /q
	cd\
	attrib -r -s -h RECYCLER
	rem rmdir RECYCLER /q
	rename RECYCLER REVISAME
	echo .-
) ELSE (
	echo NO se encuentra.-
)
if exist .Trasher (
	cd .Trasher
	attrib -r -s -h *.* /s /d
	rem del *.* /f /q
	cd\
	attrib -r -s -h .Trasher
	rem rmdir RECYCLER /q
	rename .Trasher REVISAME2
	echo .-
) ELSE (
	echo NO se encuentra.-
)
if exist .Trashes (
	cd .Trashes
	attrib -r -s -h *.* /s /d
	rem del *.* /f /q
	cd\
	attrib -r -s -h .Trashes
	rem rmdir RECYCLER /q
	rename .Trashes REVISAME3
	echo .-
) ELSE (
	echo NO se encuentra.-
)
echo // 
echo //  DESINFECCION DE SISTEMA 
echo // -------------------------------------------------------------
echo // %USERNAME%
echo    Para terminar es necesario reiniciar el sistema y recien
echo    intentar la desinfección de otras unidades.-
goto Autor

:LimpiarEvaluar
if "%ULIMPIAR%" EQU "USB" goto UBuscar
if "%ULIMPIAR%" EQU "HD" goto UBuscar

:UdadaDesinfectar
if "%ULIMPIAR%" EQU "c" goto UdelSistema
if "%ULIMPIAR%" EQU "C" goto UdelSistema
SET SIGUE=6
GOTO CARTEL
:CONTINUA6
echo // 
echo // DESINFECTANDO UNIDAD [ %ULIMPIAR% ]
echo // -------------------------------------------------------------
%ULIMPIAR%:
cd\
echo --(( Listado de objetos ocultos...
dir /ah
echo // -------------------------------------------------------------
ping -n 3 localhost > nul
echo --(( Reparando archivos infectados...
Attrib /d /s -r -s -h  "%ULIMPIAR%:\*"
echo --(( Eliminado accesos directos...
if exist "%ULIMPIAR%:\*.lnk" del /f /q "%ULIMPIAR%:\*.lnk"
echo --(( Eliminado ejecutables en la raiz
if exist "%ULIMPIAR%:\*.vs" del /f /q "%ULIMPIAR%:\*.vs"
if exist "%ULIMPIAR%:\*.cmd" del /f /q "%ULIMPIAR%:\*.cmd"
if exist "%ULIMPIAR%:\*.exe" del /p "%ULIMPIAR%:\*.exe"
if exist "%ULIMPIAR%:\*.com" del /p "%ULIMPIAR%:\*.com"
if exist "%ULIMPIAR%:\*.sys" del /p "%ULIMPIAR%:\*.sys"
echo .-
echo --(( Eliminado AUTORUN
echo ...
if exist %ULIMPIAR%:\autorun.inf del /F %ULIMPIAR%:\autorun.inf
echo --(( Evitando AUTORUN
md autorun.inf
attrib +s +r +h autorun.inf
cd autorun.inf
md autorun.inf
attrib +s +r +h autorun.inf
cd..
echo .-
echo --(( Eliminando RECYCLER...
cd\
if exist RECYLER (
	cd RECYCLER
	attrib -r -s -h *.* /s /d
	rem del *.* /f /q
	cd\
	attrib -r -s -h RECYCLER
	rem rmdir RECYCLER /q
	rename RECYCLER REVISAME
	echo .-
) ELSE (
	echo NO se encuentra.-
)
if exist .Trasher (
	cd .Trasher
	attrib -r -s -h *.* /s /d
	rem del *.* /f /q
	cd\
	attrib -r -s -h .Trasher
	rem rmdir RECYCLER /q
	rename .Trasher REVISAME2
	echo .-
) ELSE (
	echo NO se encuentra.-
)
if exist .Trashes (
	cd .Trashes
	attrib -r -s -h *.* /s /d
	rem del *.* /f /q
	cd\
	attrib -r -s -h .Trashes
	rem rmdir RECYCLER /q
	rename .Trashes REVISAME3
	echo .-
) ELSE (
	echo NO se encuentra.-
)
goto FIN

:UdelSistema
SET SIGUE=7
GOTO CARTEL
:CONTINUA7
echo // 
echo // DESINFECTANDO UNIDAD [ C: ] DE SISTEMA
echo // -------------------------------------------------------------
C:
cd\
echo --(( Listado de objetos ocultos...
dir /ah
echo // -------------------------------------------------------------
ping -n 3 localhost > nul
echo --(( Visualizando todo lo oculto...
rem Attrib /d /s -r -h -s "%ULIMPIAR%:\*"
attrib -r -s -h  *.*
echo --(( Eliminado accesos directos...
if exist "%ULIMPIAR%:\*.lnk" del /f /q "%ULIMPIAR%:\*.lnk"
echo --(( Eliminado ejecutables en la raiz
if exist "%ULIMPIAR%:\*.vs" del /f /q "%ULIMPIAR%:\*.vs"
if exist "%ULIMPIAR%:\*.cmd" del /f /q "%ULIMPIAR%:\*.cmd"
if exist "%ULIMPIAR%:\*.exe" del /p "%ULIMPIAR%:\*.exe"
echo .-
echo --(( Eliminado AUTORUN...
if exist %ULIMPIAR%:\autorun.inf del /F %ULIMPIAR%:\autorun.inf
echo --(( Evitando AUTORUN...
md autorun.inf
attrib +s +r +h autorun.inf
cd autorun.inf
md autorun.inf
attrib +s +r +h autorun.inf
cd..
echo --(( Ocultando archivos de sistema...
attrib +s +r +h boot.ini
attrib +s +r +h Bootfont.bin
attrib +s +r +h IO.SYS
attrib +s +r +h MSDOS.SYS
attrib +s +r +h NTDETECT.COM
attrib +s +r +h ntldr
echo .-
echo --(( Eliminando RECYCLER...
cd\
if exist RECYCLER (
	cd RECYCLER
	attrib -r -s -h *.* /s /d
	rem del *.* /f /q
	cd\
	attrib -r -s -h RECYCLER
	rem rmdir RECYCLER /q
	rename RECYCLER REVISAME
	echo .-
) ELSE (
	echo NO se encuentra.-
)
if exist .Trasher (
	cd .Trasher
	attrib -r -s -h *.* /s /d
	rem del *.* /f /q
	cd\
	attrib -r -s -h .Trasher
	rem rmdir RECYCLER /q
	rename .Trasher REVISAME2
	echo .-
) ELSE (
	echo NO se encuentra.-
)
if exist .Trashes (
	cd .Trashes
	attrib -r -s -h *.* /s /d
	rem del *.* /f /q
	cd\
	attrib -r -s -h .Trashes
	rem rmdir RECYCLER /q
	rename .Trashes REVISAME3
	echo .-
) ELSE (
	echo NO se encuentra.-
)
goto FIN

:UBuscar
echo --(( Buscando Unidades...
fsutil fsinfo drives
If %errorlevel% EQU 0 goto :Seguir
echo // %USERNAME%
echo // Necesitas ejecutar este script como administrador,
echo // busca la opcion en el menu contextual. 
echo .-
goto FIN

:Seguir
echo .-
setlocal Enabledelayedexpansion
for /F "tokens=1-9* delims=:\ " %%a in ('fsutil fsinfo drives') do (
	Set unidad=%%b & Call :verificar
	Set unidad=%%c & Call :verificar
	Set unidad=%%d & Call :verificar
	Set unidad=%%e & Call :verificar
	Set unidad=%%f & Call :verificar
	Set unidad=%%g & Call :verificar
	Set unidad=%%h & Call :verificar
	Set unidad=%%i & Call :verificar
	Set unidad=%%j & Call :verificar
)
echo ...
rem ping -n 3 localhost > nul
goto Fin

:Verificar
if "!unidad:~-0,1!" EQU "" goto FinVerificacion
echo --(( Verificando Unidad !unidad:~-0,1! ...
if "%ULIMPIAR%" EQU "USB" goto PreguntarUSB
if "%ULIMPIAR%" EQU "HD" goto PreguntarHD

:PreguntarUSB
fsutil fsinfo drivetype !unidad:~-0,1!: | findstr /s "extra"
If %ERRORLEVEL% EQU 0 (
	echo //// !unidad:~-0,1! Es USB
	goto Udesinfectar
) ELSE (
	goto :FinVerificacion
)
:PreguntarHD
fsutil fsinfo drivetype !unidad:~-0,1!: | findstr /s "fija"
If %ERRORLEVEL% EQU 0 (
	echo //// !unidad:~-0,1! Es Disco Duro
	goto Udesinfectar
) ELSE (
	goto :FinVerificacion
)

:Udesinfectar
if "!unidad:~-0,1!" EQU "c" goto UdelSistema
if "!unidad:~-0,1!" EQU "C" goto UdelSistema
echo .-
SET SIGUE=8
GOTO CARTEL
:CONTINUA8
echo // 
echo // DESINFECTANDO UNIDAD [ !unidad:~-0,1! ]
echo // -------------------------------------------------------------
rem Setlocal Disabledelayedexpansion
PUSHD "!unidad:~-0,1!:"
cd\
echo --(( Listado de objetos ocultos en la raiz...
dir /ah
echo // -------------------------------------------------------------
ping -n 3 localhost > nul
echo --(( Reparando archivos infectados...
Attrib /d /s -r -s -h  "!unidad:~-0,1!:\*"
echo --(( Eliminado accesos directos...
if exist "!unidad:~-0,1!:\*.lnk" del /f /q "!unidad:~-0,1!:\*.lnk"
echo --(( Eliminado ejecutables en la raiz
if exist "!unidad:~-0,1!:\*.vs" del /f /q "!unidad:~-0,1!:\*.vs"
if exist "!unidad:~-0,1!:\*.cmd" del /f /q "!unidad:~-0,1!:\*.cmd"
if exist "!unidad:~-0,1!:\*.exe" del /p "!unidad:~-0,1!:\*.exe"
echo .-
echo --(( Eliminado AUTORUN...
if exist "!unidad:~-0,1!:\autorun.inf" del /F "!unidad:~-0,1!:\autorun.inf"
echo --(( Evitando AUTORUN
md autorun.inf
attrib +s +r +h autorun.inf
cd autorun.inf
md autorun.inf
attrib +s +r +h autorun.inf
cd..
echo .-
echo --(( Eliminando RECYCLER...
cd\
if exist RECYCLER (
	cd RECYCLER
	attrib -r -s -h *.* /s /d
	rem del *.* /f /q
	cd\
	attrib -r -s -h RECYCLER
	rem rmdir RECYCLER /q
	rename RECYCLER REVISAME
	echo .-
) ELSE (
	echo NO se encuentra.-
)
if exist .Trasher (
	cd .Trasher
	attrib -r -s -h *.* /s /d
	rem del *.* /f /q
	cd\
	attrib -r -s -h .Trasher
	rem rmdir RECYCLER /q
	rename .Trasher REVISAME2
	echo .-
) ELSE (
	echo NO se encuentra.-
)
if exist .Trashes (
	cd .Trashes
	attrib -r -s -h *.* /s /d
	rem del *.* /f /q
	cd\
	attrib -r -s -h .Trashes
	rem rmdir RECYCLER /q
	rename .Trashes REVISAME3
	echo .-
) ELSE (
	echo NO se encuentra.-
)
goto FIN

:FinVerificacion
echo //// no es %ULIMPIAR%
echo .-
goto:eof

:SRVInstalar
SET SIGUE=9
GOTO CARTEL
:CONTINUA9
echo // 
echo // INSTALANDO EN LA NETBOOK DESDE EL SERVIDOR
echo // -------------------------------------------------------------
echo // %USERNAME%
echo    Conectando ...
if exist y: net use y: /delete
net use y: "\\servicios\publico\Botiquin 5089\Actualizaciones\CMD" /persistent:no > NUL
if %ERRORLEVEL% NEQ 0 goto ErrInst
y:
echo .-
echo Creando CMD ...
D:
cd\
if not exist D:\CMD md CMD
cd CMD
if exist QuitarMalware.bat del QuitarMalware.bat /q /f
echo .-
echo Copiando en DATOS ...
y:
xcopy QuitarMalware.bat D: /R /Y 
xcopy CrearLnk.vbs D: /R /Y
xcopy icono0.bat D: /R /Y
xcopy icono1.bat D: /R /Y
D:
if %RTA% EQU 0 (
	copy icono0.bat icono.bat /Y
) else (
	copy icono1.bat icono.bat /Y
)
if %ERRORLEVEL% NEQ 0 goto ErrInst
echo .-
echo Creando acceso directo en el Escritorio...
D:
if exist "%userprofile%\Desktop\QuitarMalware.lnk" del "%userprofile%\Desktop\QuitarMalware.lnk" /q /f
REM CrearLnk.vbs "%userprofile%\Desktop\QuitarMalware.lnk" D:\CMD\QuitarMalware.bat
CrearLnk.vbs "%userprofile%" D:\CMD QuitarMalware.bat
echo .-
if exist Y: net use Y: /delete
echo //
echo //  INSTALACION FINALIZADA
echo // -------------------------------------------------------------
echo // %USERNAME%
echo    Recuerda ejecutar como Administrador y revisar
echo    cualquier pendrive antes de explorarlo.-
goto Autor

:LOCInstalar
SET SIGUE=10
GOTO CARTEL
:CONTINUA10
echo // 
echo // INSTALANDO EN LA COMPU DESDE EL PENDRIVE
echo // -------------------------------------------------------------
echo // %USERNAME%
echo    Ingrese la letra de unidad asignada al Pendrive
echo    donde se encuentra la carpeta CMD ...
echo //
SET ULIMPIAR=E
SET /P ULIMPIAR="--(( Unidad [%ULIMPIAR%]: "
%ULIMPIAR%:
cd CMD
echo .-
echo // %USERNAME%
echo    Ingrese la letra de unidad donde desea instalar...
echo //
SET UDESTINO=D
SET /P UDESTINO="--(( Unidad [%UDESTINO%]: "
echo Creando CMD ...
REM D:
%UDESTINO%:
if not exist %UDESTINO%:\CMD md CMD
cd CMD
if exist QuitarMalware.bat del QuitarMalware.bat /q /f
echo .-
echo Copiando en DATOS ...
%ULIMPIAR%:
xcopy %ULIMPIAR%:\CMD\QuitarMalware.bat %UDESTINO%: /R /Y 
xcopy %ULIMPIAR%:\CMD\CrearLnk.vbs %UDESTINO%: /R /Y
xcopy %ULIMPIAR%:\CMD\icono0.bat %UDESTINO%: /R /Y
xcopy %ULIMPIAR%:\CMD\icono1.bat %UDESTINO%: /R /Y
%UDESTINO%:
if %RTA% EQU 0 (
	copy icono0.bat icono.bat /Y
) else (
	copy icono1.bat icono.bat /Y
)
if %ERRORLEVEL% NEQ 0 goto ErrInst
echo .-
echo Creando acceso directo en el Escritorio...
%UDESTINO%:
if exist "%userprofile%\Desktop\QuitarMalware.lnk" del "%userprofile%\Desktop\QuitarMalware.lnk" /q /f
if exist %userprofile%\Desktop (
	rem CrearLnk.vbs "%userprofile%\Desktop\QuitarMalware.lnk" D:\CMD\QuitarMalware.bat
	CrearLnk.vbs "%userprofile%" %UDESTINO%:\CMD QuitarMalware.bat
) else (
	echo // DEBE CREAR EL ACCESO DIRECTO EN FORMA MANUAL.
)
echo .-
echo //
echo //  INSTALACION FINALIZADA :D
echo // -------------------------------------------------------------
echo // %USERNAME%
echo    Recuerda ejecutar como Administrador y revisar cualquier
echo    pendrive antes de explorarlo.-
goto Autor

:COPInstalar
SET SIGUE=11
GOTO CARTEL
:CONTINUA11
echo // 
echo // INSTALANDO EN UN PENDRIVE
echo // -------------------------------------------------------------
echo // %USERNAME%
echo    Ingrese la letra de unidad donde se encuentra la carpeta CMD
echo    por lo general es D ...
echo //
SET UORIGEN=D
SET /P UORIGEN="--(( Unidad Origen [%UORIGEN%]: "
%UORIGEN%:
cd CMD
echo .-
echo // %USERNAME%
echo    Ingrese la letra de unidad asignada al Pendrive
echo    donde quiere copiar la carpeta CMD ...
echo //
SET ULIMPIAR=E
SET /P ULIMPIAR="--(( Unidad Destino [%ULIMPIAR%]: "
%ULIMPIAR%:
echo Creando CMD ...
if not exist %ULIMPIAR%:\CMD md CMD
cd CMD
echo .-
if exist QuitarMalware.bat del QuitarMalware.bat /q /f
echo Copiando en DATOS ...
%UORIGEN%:
xcopy %UORIGEN%:\CMD\QuitarMalware.bat %ULIMPIAR%: /R /Y 
xcopy %UORIGEN%:\CMD\CrearLnk.vbs %ULIMPIAR%: /R /Y
xcopy %UORIGEN%:\CMD\icono.bat %ULIMPIAR%: /R /Y
xcopy %UORIGEN%:\CMD\icono0.bat %ULIMPIAR%: /R /Y
xcopy %UORIGEN%:\CMD\icono1.bat %ULIMPIAR%: /R /Y
if %ERRORLEVEL% NEQ 0 goto ErrInst
echo .-
echo //
echo //  INSTALACION FINALIZADA :D
echo // -------------------------------------------------------------
echo // %USERNAME%
echo    Recuerda que la carpeta que este programa se  
echo    copio en la carpeta CMD del pendrive, desde alli puedes 
echo    instalarlo en otra compu.-
goto Autor

:ErrInst
echo // 
echo //  FALLO LA INSTALACION 
echo // -------------------------------------------------------------
echo // %USERNAME%
echo    Habla con el RTI para que instale este programa 
echo    manualmente.-
goto Autor

:FIN
echo //  
echo //  TERMINANDO LA DESINFECCION
echo // -------------------------------------------------------------
rem ejecutar el explorer si no esta en memoria
echo --(( Comprobando Explorer...
tasklist /FI "IMAGENAME EQ explorer.exe" 2>NUL | Find /I /N "explorer.exe" > NUL
if %ERRORLEVEL% EQU 1 (
	start explorer
	echo ... regresando a la normalidad: No mostrar ocultos...
	rem por hacer
	rem reg add HKLM\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced\Folder\Hidden\SHOWALL /v CheckedValue /t REG_DWORD /d 0 /f
	rem reg add HKLM\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced\Folder\Hidden\NOHIDDEN /v CheckedValue /t REG_DWORD /d 1 /f
)
echo .-
if not exist d:\.cache goto Autor
attrib +h +s d:\.cache
:Autor
echo // -------------------------------------------------------------
echo         -------------------------------------------------  
echo        + Limpieza y proteccion de memorias USB y Discos  + 
echo        + Recopilacion, modificacion y mejoras.           ++
echo        +                                                 ++
echo        +                             blaslopez@gmail.com ++
echo        + Para:                                           ++
echo        + EET8102, SEC5089, ISFD6031, ISFD6018, UNSa Oran ++
echo        +               y sus amigos ;)                   ++
echo         -------------------------------------------------++
echo          ++++++++++++++++++++++++++++++++++++++++++++++++++
echo .-
pause
exit
